<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>rest-hapi by JKHeadley</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">rest-hapi</h1>
      <h2 class="project-tagline">A RESTful API generator for hapi.</h2>
      <a href="https://github.com/JKHeadley/rest-hapi" class="btn">View on GitHub</a>
      <a href="https://github.com/JKHeadley/rest-hapi/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/JKHeadley/rest-hapi/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="rest-hapi" class="anchor" href="#rest-hapi" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>rest-hapi</h1>

<p>A RESTful API generator built around the <a href="https://github.com/hapijs/hapi">hapi</a> framework and <a href="https://github.com/Automattic/mongoose">mongoose</a> ODM.</p>

<p><a href="https://travis-ci.org/JKHeadley/rest-hapi"><img src="https://travis-ci.org/JKHeadley/rest-hapi.svg?branch=master" alt="Build Status"></a></p>

<p>rest-hapi is a framework intended to abstract the work involved in setting up API routes/validation/handlers/etc. for the purpose of rapid app development.  At the same time it provides a powerful combination of <a href="#associations">relational</a> structure with <a href="#creating-endpoints">NoSQL</a> flexibility.  You define your models and the rest is done for you.  Have your own API server up and running in minutes!</p>

<h2>
<a id="features" class="anchor" href="#features" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Features</h2>

<ul>
<li>Automatic generation of CRUD endpoints with middleware support</li>
<li>Automatic generation of association endpoints</li>
<li>
<a href="https://github.com/hapijs/joi">joi</a> validation</li>
<li>User password encryption support</li>
<li>Optional token authentication for all generated endpoints</li>
<li>Swagger docs for all generated endpoints via <a href="https://github.com/glennjones/hapi-swagger">hapi-swagger</a>
</li>
<li>Query parameter support for sorting, filtering, pagination, and embedding of associated models</li>
</ul>

<h2>
<a id="live-demo" class="anchor" href="#live-demo" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Live demo</h2>

<p>View the swagger docs for the live demo:</p>

<p><a href="http://ec2-35-162-67-113.us-west-2.compute.amazonaws.com:8124/">http://ec2-35-162-67-113.us-west-2.compute.amazonaws.com:8124/</a></p>

<h2>
<a id="readme-contents" class="anchor" href="#readme-contents" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Readme contents</h2>

<ul>
<li><a href="#requirements">Requirements</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#running-the-app">Running the app</a></li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#testing">Testing</a></li>
<li><a href="#swagger-documentation">Swagger documentation</a></li>
<li><a href="#creating-endpoints">Creating endpoints</a></li>
<li><a href="#associations">Associations</a></li>
<li><a href="#route-customization">Route customization</a></li>
<li><a href="#querying">Querying</a></li>
<li><a href="#validation">Validation</a></li>
<li><a href="#middleware">Middleware</a></li>
<li><a href="#additional-endpoints">Additional endpoints</a></li>
<li><a href="#token-authentication">Token authentication</a></li>
<li><a href="#license">License</a></li>
<li><a href="#questions">Questions</a></li>
<li><a href="#future-work">Future work</a></li>
<li><a href="#contributing">Contributing</a></li>
</ul>

<h2>
<a id="requirements" class="anchor" href="#requirements" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Requirements</h2>

<p>You need <a href="https://nodejs.org/en/">Node.js</a> installed and you'll need <a href="https://docs.mongodb.com/manual/installation/">MongoDB</a> installed and running.  You will also need the <a href="https://www.npmjs.com/package/gulp">gulp</a> node package installed.</p>

<p><a href="#readme-contents">Back to top</a></p>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installation</h2>

<pre><code>$ git clone https://github.com/JKHeadley/rest-hapi.git
$ cd rest-hapi
$ npm install
</code></pre>

<h3>
<a id="first-time-setupdemo" class="anchor" href="#first-time-setupdemo" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>First time setup/Demo</h3>

<p><strong>WARNING</strong>: This will clear all data in the following MongoDB collections (in the db defined in <code>config.local.js</code>) if they exist: <code>users</code>, <code>roles</code>.</p>

<p>If you would like to seed your database with some demo models/data, run:</p>

<pre><code>$ gulp seed
</code></pre>

<p>NOTE: The password for all seed users is <code>1234</code>.</p>

<p>You can use these models as templates for your models or delete them later if you wish.</p>

<p><a href="#readme-contents">Back to top</a></p>

<h2>
<a id="running-the-app" class="anchor" href="#running-the-app" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Running the app</h2>

<pre><code>$ gulp serve:local
</code></pre>

<p>or just</p>

<pre><code>$ gulp
</code></pre>

<p>Then point your browser to <a href="http://localhost:8124/">http://localhost:8124/</a> to view the swagger docs.</p>

<p><a href="https://www.npmjs.com/package/gulp-nodemon">gulp-nodemon</a> watches for changes in server code and restarts the app automatically.</p>

<p><a href="#readme-contents">Back to top</a></p>

<h2>
<a id="configuration" class="anchor" href="#configuration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Configuration</h2>

<p>Edit the config file relevant to your environment (local, development, production).  The default config
file is <code>/api/config.local.js</code>.  Here you can set the server port, mongodb URI, and authentication.</p>

<p><a href="#rest-hapi">Back to top</a></p>

<h1>
<a id="testing" class="anchor" href="#testing" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Testing</h1>

<p>To run tests:</p>

<pre><code>$ gulp test
</code></pre>

<p><a href="#readme-contents">Back to top</a></p>

<h2>
<a id="swagger-documentation" class="anchor" href="#swagger-documentation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Swagger documentation</h2>

<p>Swagger documentation is automatically generated for all endpoints and can be viewed by pointing a browser
at the server URL.  By default this will be <a href="http://localhost:8124/">http://localhost:8124/</a>.  The swagger docs provide quick 
access to testing your endpoints along with model schema descriptions and query options.</p>

<p><a href="#readme-contents">Back to top</a></p>

<h2>
<a id="creating-endpoints" class="anchor" href="#creating-endpoints" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Creating endpoints</h2>

<p>Restful endpoints are automatically generated based off of any mongoose models that you add to the 
<code>/api/models</code> folder with the file structure of <code>{model name}.model.js</code>.  These models must adhere to the following format:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-c1">module</span>.<span class="pl-en">exports</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">mongoose</span>) {
    <span class="pl-k">var</span> Schema <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">mongoose.Schema</span>({
        <span class="pl-c">/*fill in schema fields*/</span>
    });

    <span class="pl-smi">Schema</span>.<span class="pl-smi">statics</span> <span class="pl-k">=</span> {
        collectionName<span class="pl-k">:</span> <span class="pl-c">/*your model name*/</span>,
        routeOptions<span class="pl-k">:</span> {}
    };

    <span class="pl-k">return</span> Schema;
};</pre></div>

<p>As a concrete example, here is a <code>user</code> model:</p>

<p><code>/api/models/user.model.js</code>:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-c1">module</span>.<span class="pl-en">exports</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">mongoose</span>) {
  <span class="pl-k">var</span> modelName <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>user<span class="pl-pds">"</span></span>;
  <span class="pl-k">var</span> Types <span class="pl-k">=</span> <span class="pl-smi">mongoose</span>.<span class="pl-smi">Schema</span>.<span class="pl-smi">Types</span>;
  <span class="pl-k">var</span> Schema <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">mongoose.Schema</span>({
    email<span class="pl-k">:</span> {
      type<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-smi">String</span>,
      required<span class="pl-k">:</span> <span class="pl-c1">true</span>,
      unique<span class="pl-k">:</span> <span class="pl-c1">true</span>
    },
    password<span class="pl-k">:</span> {
      type<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-smi">String</span>,
      required<span class="pl-k">:</span> <span class="pl-c1">true</span>,
      exclude<span class="pl-k">:</span> <span class="pl-c1">true</span>,
      allowOnUpdate<span class="pl-k">:</span> <span class="pl-c1">false</span>
    }
  });

  <span class="pl-smi">Schema</span>.<span class="pl-smi">statics</span> <span class="pl-k">=</span> {
    collectionName<span class="pl-k">:</span> modelName
    routeOptions<span class="pl-k">:</span> {}
  };

  <span class="pl-k">return</span> Schema;
};</pre></div>

<p>This will generate the following CRUD endpoints:</p>

<pre><code>GET /user           Get a list of users
POST /user          Create a new user
GET /user/{_id}     Get a specific user
PUT /user/{_id}     Update a user
DELETE /user/{_id}  Delete a user
</code></pre>

<p><a href="#readme-contents">Back to top</a></p>

<h2>
<a id="associations" class="anchor" href="#associations" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Associations</h2>

<p>The rest-hapi framework supports model associations that mimic associations in 
a relational database.  This includes one-one, one-many, many-one, and many-many
relationships.  Associations are created by adding the relevant schema fields
and populating the <code>associations</code> object within <code>routeOptions</code>.  Associations
exists as references to a document's <code>_id</code> field, and can be populated to return 
the associated object.  See <a href="#querying">Querying</a> for more details on how to populate
associations.</p>

<h3>
<a id="one_one" class="anchor" href="#one_one" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ONE_ONE</h3>

<p>Below is an example of a one-one relationship between a <code>user</code> model and a
<code>dog</code> model. Notice the <code>dog</code> and <code>owner</code> fields in the schemas.  A schema
field is required for associations of type <code>ONE_ONE</code> or <code>MANY_ONE</code>.  This
field must match the association name, include a type of <code>ObjectId</code>, and
include a <code>ref</code> property with the associated model name.</p>

<p>Each association must be added to an <code>associations</code> object within the
<code>routeOptions</code> object. The <code>type</code> and <code>model</code> fields are
required for all associations.</p>

<p><code>/api/models/user.model.js</code>:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-c1">module</span>.<span class="pl-en">exports</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">mongoose</span>) {
  <span class="pl-k">var</span> modelName <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>user<span class="pl-pds">"</span></span>;
  <span class="pl-k">var</span> Types <span class="pl-k">=</span> <span class="pl-smi">mongoose</span>.<span class="pl-smi">Schema</span>.<span class="pl-smi">Types</span>;
  <span class="pl-k">var</span> Schema <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">mongoose.Schema</span>({
    email<span class="pl-k">:</span> {
      type<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-smi">String</span>,
      required<span class="pl-k">:</span> <span class="pl-c1">true</span>,
      unique<span class="pl-k">:</span> <span class="pl-c1">true</span>
    },
    password<span class="pl-k">:</span> {
      type<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-smi">String</span>,
      required<span class="pl-k">:</span> <span class="pl-c1">true</span>,
      exclude<span class="pl-k">:</span> <span class="pl-c1">true</span>,
      allowOnUpdate<span class="pl-k">:</span> <span class="pl-c1">false</span>
    },
    dog<span class="pl-k">:</span> {
      type<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-smi">ObjectId</span>,
      ref<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>dog<span class="pl-pds">"</span></span>
    }
  });

  <span class="pl-smi">Schema</span>.<span class="pl-smi">statics</span> <span class="pl-k">=</span> {
    collectionName<span class="pl-k">:</span>modelName,
    routeOptions<span class="pl-k">:</span> {
      associations<span class="pl-k">:</span> {
        dog<span class="pl-k">:</span> {
          type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>ONE_ONE<span class="pl-pds">"</span></span>,
          model<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>dog<span class="pl-pds">"</span></span>
        }
      }
    }
  };

  <span class="pl-k">return</span> Schema;
};</pre></div>

<p><code>/api/models/dog.model.js</code>:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-c1">module</span>.<span class="pl-en">exports</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">mongoose</span>) {
  <span class="pl-k">var</span> modelName <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>dog<span class="pl-pds">"</span></span>;
  <span class="pl-k">var</span> Types <span class="pl-k">=</span> <span class="pl-smi">mongoose</span>.<span class="pl-smi">Schema</span>.<span class="pl-smi">Types</span>;
  <span class="pl-k">var</span> Schema <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">mongoose.Schema</span>({
    name<span class="pl-k">:</span> {
      type<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-smi">String</span>,
      required<span class="pl-k">:</span> <span class="pl-c1">true</span>
    },
    breed<span class="pl-k">:</span> {
      type<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-smi">String</span>
    },
    owner<span class="pl-k">:</span> {
      type<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-smi">ObjectId</span>,
      ref<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>user<span class="pl-pds">"</span></span>
    }
  });

  <span class="pl-smi">Schema</span>.<span class="pl-smi">statics</span> <span class="pl-k">=</span> {
    collectionName<span class="pl-k">:</span>modelName,
    routeOptions<span class="pl-k">:</span> {
      associations<span class="pl-k">:</span> {
        owner<span class="pl-k">:</span> {
          type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>ONE_ONE<span class="pl-pds">"</span></span>,
          model<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>user<span class="pl-pds">"</span></span>
        }
      }
    }
  };

  <span class="pl-k">return</span> Schema;
};</pre></div>

<h3>
<a id="one_manymany_one" class="anchor" href="#one_manymany_one" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ONE_MANY/MANY_ONE</h3>

<p>Below is an example of a one-many/many-one relationship between the <code>user</code>
and <code>role</code> models.  Notice the <code>title</code> field in the schema.  A schema
field is required for associations of type <code>ONE_ONE</code> or <code>MANY_ONE</code>.  This
field must match the association name, include a type of <code>ObjectId</code>, and
include a <code>ref</code> property with the associated model name.</p>

<p><code>/api/models/user.model.js</code>:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-c1">module</span>.<span class="pl-en">exports</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">mongoose</span>) {
  <span class="pl-k">var</span> modelName <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>user<span class="pl-pds">"</span></span>;
  <span class="pl-k">var</span> Types <span class="pl-k">=</span> <span class="pl-smi">mongoose</span>.<span class="pl-smi">Schema</span>.<span class="pl-smi">Types</span>;
  <span class="pl-k">var</span> Schema <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">mongoose.Schema</span>({
    email<span class="pl-k">:</span> {
      type<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-smi">String</span>,
      required<span class="pl-k">:</span> <span class="pl-c1">true</span>,
      unique<span class="pl-k">:</span> <span class="pl-c1">true</span>
    },
    password<span class="pl-k">:</span> {
      type<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-smi">String</span>,
      required<span class="pl-k">:</span> <span class="pl-c1">true</span>,
      exclude<span class="pl-k">:</span> <span class="pl-c1">true</span>,
      allowOnUpdate<span class="pl-k">:</span> <span class="pl-c1">false</span>
    },
    title<span class="pl-k">:</span> {
      type<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-smi">ObjectId</span>,
      ref<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>role<span class="pl-pds">"</span></span>
    }

  });

  <span class="pl-smi">Schema</span>.<span class="pl-smi">statics</span> <span class="pl-k">=</span> {
    collectionName<span class="pl-k">:</span>modelName,
    routeOptions<span class="pl-k">:</span> {
      associations<span class="pl-k">:</span> {
        title<span class="pl-k">:</span> {
          type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>MANY_ONE<span class="pl-pds">"</span></span>,
          model<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>role<span class="pl-pds">"</span></span>
        }
      }
    }
  };

  <span class="pl-k">return</span> Schema;
};</pre></div>

<p><code>/api/models/role.model.js</code>:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-c1">module</span>.<span class="pl-en">exports</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">mongoose</span>) {
  <span class="pl-k">var</span> modelName <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>role<span class="pl-pds">"</span></span>;
  <span class="pl-k">var</span> Types <span class="pl-k">=</span> <span class="pl-smi">mongoose</span>.<span class="pl-smi">Schema</span>.<span class="pl-smi">Types</span>;
  <span class="pl-k">var</span> Schema <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">mongoose.Schema</span>({
    name<span class="pl-k">:</span> {
      type<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-smi">String</span>,
      required<span class="pl-k">:</span> <span class="pl-c1">true</span>,
      enum<span class="pl-k">:</span> [<span class="pl-s"><span class="pl-pds">"</span>Account<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Admin<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>SuperAdmin<span class="pl-pds">"</span></span>]
    },
    description<span class="pl-k">:</span> {
      type<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-smi">String</span>
    }
  });

  <span class="pl-smi">Schema</span>.<span class="pl-smi">statics</span> <span class="pl-k">=</span> {
    collectionName<span class="pl-k">:</span>modelName,
    routeOptions<span class="pl-k">:</span> {
      associations<span class="pl-k">:</span> {
        users<span class="pl-k">:</span> {
          type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>ONE_MANY<span class="pl-pds">"</span></span>,
          foreignField<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>title<span class="pl-pds">"</span></span>,
          model<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>user<span class="pl-pds">"</span></span>
        }
      }
    }
  };

  <span class="pl-k">return</span> Schema;
};</pre></div>

<p>In this example, a user can belong to one role and a role can be 
assigned to many users.  The <code>type</code> and <code>model</code> fields are
required for all associations, and the <code>foreignField</code> field is 
required for <code>ONE_MANY</code> type associations.  </p>

<p>Along with the normal CRUD endpoints, the following association 
endpoints will be generated for the <code>role</code> model:</p>

<pre><code>GET /role/{ownerId}/user                Gets all of the users for a role
POST /role/{ownerId}/user               Sets multiple users for a role
PUT /role/{ownerId}/user/{childId}      Add a single user object to a role's list of users
DELETE /role/{ownerId}/user/{childId}   Remove a single user object from a role's list of users
</code></pre>

<h3>
<a id="many_many" class="anchor" href="#many_many" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>MANY_MANY</h3>

<p>Below is an example of a many-many relationship between the <code>user</code> and
<code>group</code> models. In this relationship a single <code>user</code> instance can belong
to multiple <code>group</code> instances and vice versa.</p>

<p><code>/api/models/user.model.js</code>:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-c1">module</span>.<span class="pl-en">exports</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">mongoose</span>) {
  <span class="pl-k">var</span> modelName <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>user<span class="pl-pds">"</span></span>;
  <span class="pl-k">var</span> Types <span class="pl-k">=</span> <span class="pl-smi">mongoose</span>.<span class="pl-smi">Schema</span>.<span class="pl-smi">Types</span>;
  <span class="pl-k">var</span> Schema <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">mongoose.Schema</span>({
    email<span class="pl-k">:</span> {
      type<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-smi">String</span>,
      required<span class="pl-k">:</span> <span class="pl-c1">true</span>,
      unique<span class="pl-k">:</span> <span class="pl-c1">true</span>
    },
    password<span class="pl-k">:</span> {
      type<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-smi">String</span>,
      required<span class="pl-k">:</span> <span class="pl-c1">true</span>,
      exclude<span class="pl-k">:</span> <span class="pl-c1">true</span>,
      allowOnUpdate<span class="pl-k">:</span> <span class="pl-c1">false</span>
    }
  });

  <span class="pl-smi">Schema</span>.<span class="pl-smi">statics</span> <span class="pl-k">=</span> {
    collectionName<span class="pl-k">:</span>modelName,
    routeOptions<span class="pl-k">:</span> {
      associations<span class="pl-k">:</span> {
        groups<span class="pl-k">:</span> {
          type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>MANY_MANY<span class="pl-pds">"</span></span>,
          model<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>group<span class="pl-pds">"</span></span>
        }
      }
    }
  };

  <span class="pl-k">return</span> Schema;
};</pre></div>

<p><code>/api/models/group.model.js</code>:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-c1">module</span>.<span class="pl-en">exports</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">mongoose</span>) {
  <span class="pl-k">var</span> modelName <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>group<span class="pl-pds">"</span></span>;
  <span class="pl-k">var</span> Types <span class="pl-k">=</span> <span class="pl-smi">mongoose</span>.<span class="pl-smi">Schema</span>.<span class="pl-smi">Types</span>;
  <span class="pl-k">var</span> Schema <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">mongoose.Schema</span>({
    name<span class="pl-k">:</span> {
      type<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-smi">String</span>,
      required<span class="pl-k">:</span> <span class="pl-c1">true</span>,
    },
    description<span class="pl-k">:</span> {
      type<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-smi">String</span>
    }
  });

  <span class="pl-smi">Schema</span>.<span class="pl-smi">statics</span> <span class="pl-k">=</span> {
    collectionName<span class="pl-k">:</span>modelName,
    routeOptions<span class="pl-k">:</span> {
      associations<span class="pl-k">:</span> {
        users<span class="pl-k">:</span> {
          type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>MANY_MANY<span class="pl-pds">"</span></span>,
          model<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>user<span class="pl-pds">"</span></span>
        }
      }
    }
  };

  <span class="pl-k">return</span> Schema;
};</pre></div>

<p>Along with the normal CRUD endpoints, the following association 
endpoints will be generated for the <code>user</code> model:</p>

<pre><code>GET /user/{ownerId}/group               Gets all of the groups for a user
POST /user/{ownerId}/group              Sets multiple groups for a user
PUT /user/{ownerId}/group/{childId}     Add a single group object to a user's list of groups
DELETE /user/{ownerId}/group/{childId}  Remove a single group object from a user's list of groups
</code></pre>

<p>and for the <code>group</code> model:</p>

<pre><code>GET /group/{ownerId}/user               Gets all of the users for a group
POST /group/{ownerId}/user              Sets multiple users for a group
PUT /group/{ownerId}/user/{childId}     Add a single user object to a group's list of users
DELETE /group/{ownerId}/user/{childId}  Remove a single user object from a group's list of users
</code></pre>

<h4>
<a id="many_many-linking-models" class="anchor" href="#many_many-linking-models" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>MANY_MANY linking models</h4>

<p>Many-many relationships can include extra fields that contain data specific
to each association instance.  This is accomplished through linking models which
behave similar to pivot tables in a relational database.  Linking model files are
stored in the <code>/api/models/linking-models</code> directory and follow the same 
<code>{name}.model.js</code> format as normal models.  Below is an example of a many-many
relationship between the <code>user</code> model and itself through the <code>friends</code> association.
The extra field <code>friendsSince</code> could contain a date representing how long the two
associated users have known each other.  This example also displays how models can contain a 
reference to themselves.  </p>

<p><code>/api/models/user.model.js</code>:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-c1">module</span>.<span class="pl-en">exports</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">mongoose</span>) {
  <span class="pl-k">var</span> modelName <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>user<span class="pl-pds">"</span></span>;
  <span class="pl-k">var</span> Types <span class="pl-k">=</span> <span class="pl-smi">mongoose</span>.<span class="pl-smi">Schema</span>.<span class="pl-smi">Types</span>;
  <span class="pl-k">var</span> Schema <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">mongoose.Schema</span>({
    email<span class="pl-k">:</span> {
      type<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-smi">String</span>,
      required<span class="pl-k">:</span> <span class="pl-c1">true</span>,
      unique<span class="pl-k">:</span> <span class="pl-c1">true</span>
    },
    password<span class="pl-k">:</span> {
      type<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-smi">String</span>,
      required<span class="pl-k">:</span> <span class="pl-c1">true</span>,
      exclude<span class="pl-k">:</span> <span class="pl-c1">true</span>,
      allowOnUpdate<span class="pl-k">:</span> <span class="pl-c1">false</span>
    }
  });

  <span class="pl-smi">Schema</span>.<span class="pl-smi">statics</span> <span class="pl-k">=</span> {
    collectionName<span class="pl-k">:</span>modelName,
    routeOptions<span class="pl-k">:</span> {
      associations<span class="pl-k">:</span> {
        friends<span class="pl-k">:</span> {
          type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>MANY_MANY<span class="pl-pds">"</span></span>,
          model<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>user<span class="pl-pds">"</span></span>,
          alias<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>friend<span class="pl-pds">"</span></span>,
          linkingModel<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>user_user<span class="pl-pds">"</span></span>
        }
      }
    }
  };

  <span class="pl-k">return</span> Schema;
};</pre></div>

<p><code>/api/models/linking-models/user_user.model.js</code>:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> mongoose <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">"</span>mongoose<span class="pl-pds">"</span></span>);

<span class="pl-c1">module</span>.<span class="pl-en">exports</span> <span class="pl-k">=</span> <span class="pl-k">function</span> () {

  <span class="pl-k">var</span> Types <span class="pl-k">=</span> <span class="pl-smi">mongoose</span>.<span class="pl-smi">Schema</span>.<span class="pl-smi">Types</span>;

  <span class="pl-k">var</span> Model <span class="pl-k">=</span> {
    Schema<span class="pl-k">:</span> {
      friendsSince<span class="pl-k">:</span> {
        type<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-smi">Date</span>
      }
    },
    modelName<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>user_user<span class="pl-pds">"</span></span>
  };

  <span class="pl-k">return</span> Model;
};</pre></div>

<p><a href="#readme-contents">Back to top</a></p>

<h2>
<a id="route-customization" class="anchor" href="#route-customization" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Route customization</h2>

<p>By default route paths are constructed using model names, however aliases can be provided to customize the route paths.
<code>routeOptions.alias</code> can be set to alter the base path name, and an <code>alias</code> property for an association can be set 
to alter the association path name.  For example:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-c1">module</span>.<span class="pl-en">exports</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">mongoose</span>) {
  <span class="pl-k">var</span> modelName <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>user<span class="pl-pds">"</span></span>;
  <span class="pl-k">var</span> Types <span class="pl-k">=</span> <span class="pl-smi">mongoose</span>.<span class="pl-smi">Schema</span>.<span class="pl-smi">Types</span>;
  <span class="pl-k">var</span> Schema <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">mongoose.Schema</span>({
    email<span class="pl-k">:</span> {
      type<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-smi">String</span>,
      required<span class="pl-k">:</span> <span class="pl-c1">true</span>,
      unique<span class="pl-k">:</span> <span class="pl-c1">true</span>
    },
    password<span class="pl-k">:</span> {
      type<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-smi">String</span>,
      required<span class="pl-k">:</span> <span class="pl-c1">true</span>,
      exclude<span class="pl-k">:</span> <span class="pl-c1">true</span>,
      allowOnUpdate<span class="pl-k">:</span> <span class="pl-c1">false</span>
    }
  });

  <span class="pl-smi">Schema</span>.<span class="pl-smi">statics</span> <span class="pl-k">=</span> {
    collectionName<span class="pl-k">:</span> modelName
    routeOptions<span class="pl-k">:</span> {
      alias<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>person<span class="pl-pds">"</span></span>
      associations<span class="pl-k">:</span> {
        groups<span class="pl-k">:</span> {
          type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>MANY_MANY<span class="pl-pds">"</span></span>,
          model<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>group<span class="pl-pds">"</span></span>,
          alias<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>team<span class="pl-pds">"</span></span>
        }
      }
    }
  };

  <span class="pl-k">return</span> Schema;
};</pre></div>

<p>will result in the following endpoints:</p>

<pre><code>GET /person 
POST /person
DELETE /person/{_id} 
PUT /person/{_id} 
GET /person/{_id} 
POST /person/{ownerId}/team 
GET /person/{ownerId}/team 
PUT /person/{ownerId}/team/{childId} 
DELETE /person/{ownerId}/team/{childId}
</code></pre>

<p><a href="#readme-contents">Back to top</a></p>

<h2>
<a id="querying" class="anchor" href="#querying" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Querying</h2>

<p>Query parameters can be added to GET requests to filter responses.  These parameters
are structured and function similar to mongoose queries.  Below is a list of currently 
supported parameters:</p>

<ul>
<li>
<p>$skip</p>

<ul>
<li>The number of records to skip in the database. This is typically used in pagination.</li>
</ul>
</li>
<li>
<p>$limit</p>

<ul>
<li>The maximum number of records to return. This is typically used in pagination.</li>
</ul>
</li>
<li>
<p>$select</p>

<ul>
<li>A list of basic fields to be included in each resource.</li>
</ul>
</li>
<li>
<p>$sort</p>

<ul>
<li>A set of fields to sort by. Including field name indicates it should be sorted ascending, 
while prepending '-' indicates descending. The default sort direction is 'ascending' 
(lowest value to highest value). Listing multiple fields prioritizes the sort starting with the first field listed. </li>
</ul>
</li>
<li>
<p>$embed</p>

<ul>
<li>A set of associations to populate. </li>
</ul>
</li>
<li>
<p>$where</p>

<ul>
<li>An optional field for raw mongoose queries.</li>
</ul>
</li>
<li>
<p>(field "where" queries)</p>

<ul>
<li>Ex: <code>/user?email=test@user.com</code>
</li>
</ul>
</li>
</ul>

<p>Query parameters can either be passed in as a single string, or an array of strings.</p>

<h3>
<a id="populate-nested-associations" class="anchor" href="#populate-nested-associations" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Populate nested associations</h3>

<p>Associations can be populated through the <code>$embed</code> parameter.  To populate nested associations,
simply chain a parameter with <code>.</code>.  For example, consider the MANY_MANY group-user association
from the example above.  If we populate the users of a group with <code>/group?$embed=users</code> we might get a 
response like so:</p>

<div class="highlight highlight-source-json"><pre>{
    <span class="pl-s"><span class="pl-pds">"</span>_id<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>58155f1a071468d3bda0fc6e<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>A-team<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>users<span class="pl-pds">"</span></span>: [
      {
        <span class="pl-s"><span class="pl-pds">"</span>user<span class="pl-pds">"</span></span>: {
          <span class="pl-s"><span class="pl-pds">"</span>_id<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>580fc1a0e2d3308609470bc6<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>email<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>test@user.com<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>title<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>580fc1e2e2d3308609470bc8<span class="pl-pds">"</span></span>
        },
        <span class="pl-s"><span class="pl-pds">"</span>_id<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>58155f6a071468d3bda0fc6f<span class="pl-pds">"</span></span>
      },
      {
        <span class="pl-s"><span class="pl-pds">"</span>user<span class="pl-pds">"</span></span>: {
          <span class="pl-s"><span class="pl-pds">"</span>_id<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>5813ad3d0d4e5c822d2f05bd<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>email<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>test2@user.com<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>title<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>580fc1eee2d3308609470bc9<span class="pl-pds">"</span></span>
        },
        <span class="pl-s"><span class="pl-pds">"</span>_id<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>58155f6a071468d3bda0fc71<span class="pl-pds">"</span></span>
      }
    ]
}</pre></div>

<p>However we can further populate each user's <code>title</code> field with a nested <code>$embed</code>
parameter: <code>/group?$embed=users.title</code> which could result in the following response:</p>

<div class="highlight highlight-source-json"><pre>{
    <span class="pl-s"><span class="pl-pds">"</span>_id<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>58155f1a071468d3bda0fc6e<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>A-team<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>users<span class="pl-pds">"</span></span>: [
      {
        <span class="pl-s"><span class="pl-pds">"</span>user<span class="pl-pds">"</span></span>: {
          <span class="pl-s"><span class="pl-pds">"</span>_id<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>580fc1a0e2d3308609470bc6<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>email<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>test@user.com<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>title<span class="pl-pds">"</span></span>: {
            <span class="pl-s"><span class="pl-pds">"</span>_id<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>580fc1e2e2d3308609470bc8<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Admin<span class="pl-pds">"</span></span>
          }
        },
        <span class="pl-s"><span class="pl-pds">"</span>_id<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>58155f6a071468d3bda0fc6f<span class="pl-pds">"</span></span>
      },
      {
        <span class="pl-s"><span class="pl-pds">"</span>user<span class="pl-pds">"</span></span>: {
          <span class="pl-s"><span class="pl-pds">"</span>_id<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>5813ad3d0d4e5c822d2f05bd<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>email<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>test2@user.com<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>title<span class="pl-pds">"</span></span>: {
            <span class="pl-s"><span class="pl-pds">"</span>_id<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>580fc1eee2d3308609470bc9<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>SuperAdmin<span class="pl-pds">"</span></span>
          }
        },
        <span class="pl-s"><span class="pl-pds">"</span>_id<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>58155f6a071468d3bda0fc71<span class="pl-pds">"</span></span>
      }
    ]
}</pre></div>

<p><a href="#readme-contents">Back to top</a></p>

<h2>
<a id="validation" class="anchor" href="#validation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Validation</h2>

<p>Validation in the rest-hapi framework is implemented with <a href="https://github.com/hapijs/joi">joi</a>.<br>
This includes validation of headers, query parameters, payloads, and responses.  joi validation models
are based primarily off of each model's field properties.  Below is a list of mongoose schema types 
and their joi equivalent within rest-hapi:</p>

<table>
<thead>
<tr>
<th>Schema Type</th>
<th>joi Validation</th>
</tr>
</thead>
<tbody>
<tr>
<td>ObjectId</td>
<td>Joi.objectId() (via <a href="https://www.npmjs.com/package/joi-objectid">joi-objectid</a>)</td>
</tr>
<tr>
<td>Boolean</td>
<td>Joi.bool()</td>
</tr>
<tr>
<td>Number</td>
<td>Joi.number()</td>
</tr>
<tr>
<td>Date</td>
<td>Joi.date()</td>
</tr>
<tr>
<td>String</td>
<td>Joi.string()</td>
</tr>
<tr>
<td>types</td>
<td>Joi.any()</td>
</tr>
</tbody>
</table>

<p>Fields of type <code>String</code> that include an <code>enum</code> property result in the following joi validation:</p>

<table>
<thead>
<tr>
<th>Field Property</th>
<th>joi Validation</th>
</tr>
</thead>
<tbody>
<tr>
<td>enum: [items]</td>
<td>Joi.any().only([items])</td>
</tr>
</tbody>
</table>

<p>rest-hapi generates joi validation models for create, read, and update events as well as association events with linking models.  By default these validation models include all the fields of the mongoose models and list them as optional.  However additional field properties can be included to customize the validation models.  Below is a list of currently supported field properties and their effect on the validation models.</p>

<table>
<thead>
<tr>
<th>Field Property</th>
<th>Validation Model</th>
</tr>
</thead>
<tbody>
<tr>
<td>required: true</td>
<td>field required on create</td>
</tr>
<tr>
<td>requireOnRead: true</td>
<td>field required on read/response</td>
</tr>
<tr>
<td>requireOnUpdate: true</td>
<td>field required on update</td>
</tr>
<tr>
<td>allowOnRead: false</td>
<td>field excluded from read model</td>
</tr>
<tr>
<td>allowOnUpdate: false</td>
<td>field excluded from update model</td>
</tr>
<tr>
<td>allowOnUpdate: false</td>
<td>field excluded from create model</td>
</tr>
<tr>
<td>queryable: false</td>
<td>field cannot be included as a query parameter</td>
</tr>
<tr>
<td>exclude: true</td>
<td>field cannot be included in a response or as part of a query</td>
</tr>
<tr>
<td>allowNull: true</td>
<td>field accepts <code>null</code> as a valid value</td>
</tr>
</tbody>
</table>

<p><a href="#readme-contents">Back to top</a></p>

<h2>
<a id="middleware" class="anchor" href="#middleware" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Middleware</h2>

<p>Models can support middleware functions for CRUD operations. These
exist under the <code>routeOptions</code> object. Middleware functions must return
 a promise.  The following middleware functions
are available:</p>

<ul>
<li>list: 

<ul>
<li>post(request, result, Log)</li>
</ul>
</li>
<li>find: 

<ul>
<li>post(request, result, Log)</li>
</ul>
</li>
<li>create:

<ul>
<li>pre(request, Log)</li>
<li>post(request, result, Log)</li>
</ul>
</li>
<li>update: 

<ul>
<li>pre(request, Log)</li>
<li>post(request, result, Log)</li>
</ul>
</li>
<li>delete: 

<ul>
<li>pre(request, Log)</li>
<li>post(request, result, Log)</li>
</ul>
</li>
</ul>

<p>For example, a <code>create: pre</code> function can be defined to encrypt a users password
using the built-in <code>password-helper</code> utility.  Notice the use of the <code>Q</code> library
to return a promise.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> <span class="pl-c1">Q</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>q<span class="pl-pds">'</span></span>);

<span class="pl-c1">module</span>.<span class="pl-en">exports</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">mongoose</span>) {
  <span class="pl-k">var</span> modelName <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>user<span class="pl-pds">"</span></span>;
  <span class="pl-k">var</span> Types <span class="pl-k">=</span> <span class="pl-smi">mongoose</span>.<span class="pl-smi">Schema</span>.<span class="pl-smi">Types</span>;
  <span class="pl-k">var</span> Schema <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">mongoose.Schema</span>({
    email<span class="pl-k">:</span> {
      type<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-smi">String</span>,
      required<span class="pl-k">:</span> <span class="pl-c1">true</span>,
      unique<span class="pl-k">:</span> <span class="pl-c1">true</span>
    },
    password<span class="pl-k">:</span> {
      type<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-smi">String</span>,
      required<span class="pl-k">:</span> <span class="pl-c1">true</span>,
      exclude<span class="pl-k">:</span> <span class="pl-c1">true</span>,
      allowOnUpdate<span class="pl-k">:</span> <span class="pl-c1">false</span>
    }
  });

  <span class="pl-smi">Schema</span>.<span class="pl-smi">statics</span><span class="pl-k">=</span> {
    collectionName<span class="pl-k">:</span> modelName
    routeOptions<span class="pl-k">:</span> {
      create<span class="pl-k">:</span> {
        <span class="pl-en">pre</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">Log</span>) {
          <span class="pl-k">var</span> deferred <span class="pl-k">=</span> <span class="pl-c1">Q</span>.<span class="pl-c1">defer</span>();
          <span class="pl-k">var</span> passwordUtility <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>../../api/utilities/password-helper<span class="pl-pds">'</span></span>);
          <span class="pl-k">var</span> hashedPassword <span class="pl-k">=</span> <span class="pl-smi">passwordUtility</span>.<span class="pl-en">hash_password</span>(<span class="pl-smi">request</span>.<span class="pl-smi">payload</span>.<span class="pl-smi">password</span>);

          <span class="pl-smi">request</span>.<span class="pl-smi">payload</span>.<span class="pl-smi">password</span> <span class="pl-k">=</span> hashedPassword;
          <span class="pl-smi">deferred</span>.<span class="pl-en">resolve</span>(request);
          <span class="pl-k">return</span> <span class="pl-smi">deferred</span>.<span class="pl-smi">promise</span>;
        }
      }
    }
  };

  <span class="pl-k">return</span> Schema;
};</pre></div>

<p><a href="#readme-contents">Back to top</a></p>

<h2>
<a id="additional-endpoints" class="anchor" href="#additional-endpoints" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Additional endpoints</h2>

<p>If endpoints beyond the generated CRUD endpoints are needed, they can easily be added 
to a model as an item in the <code>routeOptions.extraEndpoints</code> array.  The endpoint
logic should be contained within a function using the footprint: <code>function (server, model, options, Log)</code>
. For example, if we wanted to add a <code>Password Update</code> endpoint to the <code>user</code> model, it could
look like this:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> Joi <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>joi<span class="pl-pds">'</span></span>);
<span class="pl-smi">Joi</span>.<span class="pl-smi">objectId</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>joi-objectid<span class="pl-pds">'</span></span>)(Joi);
<span class="pl-k">var</span> Boom <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>boom<span class="pl-pds">'</span></span>);

<span class="pl-c1">module</span>.<span class="pl-en">exports</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">mongoose</span>) {
  <span class="pl-k">var</span> modelName <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>user<span class="pl-pds">"</span></span>;
  <span class="pl-k">var</span> Types <span class="pl-k">=</span> <span class="pl-smi">mongoose</span>.<span class="pl-smi">Schema</span>.<span class="pl-smi">Types</span>;
  <span class="pl-k">var</span> Schema <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">mongoose.Schema</span>({
    email<span class="pl-k">:</span> {
      type<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-smi">String</span>,
      required<span class="pl-k">:</span> <span class="pl-c1">true</span>,
      unique<span class="pl-k">:</span> <span class="pl-c1">true</span>
    },
    password<span class="pl-k">:</span> {
      type<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-smi">String</span>,
      required<span class="pl-k">:</span> <span class="pl-c1">true</span>,
      exclude<span class="pl-k">:</span> <span class="pl-c1">true</span>,
      allowOnUpdate<span class="pl-k">:</span> <span class="pl-c1">false</span>
    }
  });

  <span class="pl-smi">Schema</span>.<span class="pl-smi">statics</span> <span class="pl-k">=</span> {
    collectionName<span class="pl-k">:</span>modelName,
    routeOptions<span class="pl-k">:</span> {
      extraEndpoints<span class="pl-k">:</span> [
        <span class="pl-c">//Password Update Endpoint</span>
        <span class="pl-k">function</span> (<span class="pl-smi">server</span>, <span class="pl-smi">model</span>, <span class="pl-smi">options</span>, <span class="pl-smi">Log</span>) {
          Log <span class="pl-k">=</span> <span class="pl-smi">Log</span>.<span class="pl-en">bind</span>(<span class="pl-s"><span class="pl-pds">"</span>Password Update<span class="pl-pds">"</span></span>);

          <span class="pl-k">var</span> collectionName <span class="pl-k">=</span> <span class="pl-smi">model</span>.<span class="pl-smi">collectionDisplayName</span> <span class="pl-k">||</span> <span class="pl-smi">model</span>.<span class="pl-smi">modelName</span>;

          <span class="pl-smi">Log</span>.<span class="pl-en">note</span>(<span class="pl-s"><span class="pl-pds">"</span>Generating Password Update endpoint for <span class="pl-pds">"</span></span> <span class="pl-k">+</span> collectionName);

          <span class="pl-k">var</span> <span class="pl-en">handler</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {
            <span class="pl-k">var</span> passwordUtility <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>../../api/utilities/password-helper<span class="pl-pds">'</span></span>);
            <span class="pl-k">var</span> hashedPassword <span class="pl-k">=</span> <span class="pl-smi">passwordUtility</span>.<span class="pl-en">hash_password</span>(<span class="pl-smi">request</span>.<span class="pl-smi">payload</span>.<span class="pl-smi">password</span>);
            <span class="pl-k">return</span> <span class="pl-smi">model</span>.<span class="pl-en">findByIdAndUpdate</span>(<span class="pl-smi">request</span>.<span class="pl-smi">params</span>.<span class="pl-smi">_id</span>, {password<span class="pl-k">:</span> hashedPassword}).<span class="pl-en">then</span>(<span class="pl-k">function</span> (<span class="pl-smi">result</span>) {
              <span class="pl-k">if</span> (result) {
                <span class="pl-k">return</span> <span class="pl-en">reply</span>(<span class="pl-s"><span class="pl-pds">"</span>Password updated.<span class="pl-pds">"</span></span>).<span class="pl-c1">code</span>(<span class="pl-c1">200</span>);
              }
              <span class="pl-k">else</span> {
                <span class="pl-k">return</span> <span class="pl-en">reply</span>(<span class="pl-smi">Boom</span>.<span class="pl-en">notFound</span>(<span class="pl-s"><span class="pl-pds">"</span>No resource was found with that id.<span class="pl-pds">"</span></span>));
              }
            })
            .<span class="pl-en">catch</span>(<span class="pl-k">function</span> (<span class="pl-smi">error</span>) {
              <span class="pl-smi">Log</span>.<span class="pl-en">error</span>(<span class="pl-s"><span class="pl-pds">"</span>error: <span class="pl-pds">"</span></span>, error);
              <span class="pl-k">return</span> <span class="pl-en">reply</span>(<span class="pl-smi">Boom</span>.<span class="pl-en">badImplementation</span>(<span class="pl-s"><span class="pl-pds">"</span>An error occurred updating the resource.<span class="pl-pds">"</span></span>, error));
            });
          }

          <span class="pl-smi">server</span>.<span class="pl-en">route</span>({
            method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>PUT<span class="pl-pds">'</span></span>,
            path<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>/user/{_id}/password<span class="pl-pds">'</span></span>,
            config<span class="pl-k">:</span> {
              handler<span class="pl-k">:</span> handler,
              auth<span class="pl-k">:</span> <span class="pl-c1">null</span>,
              description<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Update a user<span class="pl-cce">\'</span>s password.<span class="pl-pds">'</span></span>,
              tags<span class="pl-k">:</span> [<span class="pl-s"><span class="pl-pds">'</span>api<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>User<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>Password<span class="pl-pds">'</span></span>],
              validate<span class="pl-k">:</span> {
                params<span class="pl-k">:</span> {
                  _id<span class="pl-k">:</span> <span class="pl-smi">Joi</span>.<span class="pl-en">objectId</span>().<span class="pl-en">required</span>()
                },
                payload<span class="pl-k">:</span> {
                  password<span class="pl-k">:</span> <span class="pl-smi">Joi</span>.<span class="pl-en">string</span>().<span class="pl-en">required</span>()
                  .<span class="pl-c1">description</span>(<span class="pl-s"><span class="pl-pds">'</span>The user<span class="pl-cce">\'</span>s new password<span class="pl-pds">'</span></span>)
                }
              },
              plugins<span class="pl-k">:</span> {
                <span class="pl-s"><span class="pl-pds">'</span>hapi-swagger<span class="pl-pds">'</span></span><span class="pl-k">:</span> {
                  responseMessages<span class="pl-k">:</span> [
                    {code<span class="pl-k">:</span> <span class="pl-c1">200</span>, message<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Success<span class="pl-pds">'</span></span>},
                    {code<span class="pl-k">:</span> <span class="pl-c1">400</span>, message<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Bad Request<span class="pl-pds">'</span></span>},
                    {code<span class="pl-k">:</span> <span class="pl-c1">404</span>, message<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Not Found<span class="pl-pds">'</span></span>},
                    {code<span class="pl-k">:</span> <span class="pl-c1">500</span>, message<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Internal Server Error<span class="pl-pds">'</span></span>}
                  ]
                }
              }
            }
          });
        }
      ]
    }
  };

  <span class="pl-k">return</span> Schema;
};
</pre></div>

<p><a href="#readme-contents">Back to top</a></p>

<h2>
<a id="token-authentication" class="anchor" href="#token-authentication" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Token authentication</h2>

<p>The rest-hapi framework supports built in token authentication for all generated endpoints given the following requirements are fulfilled:</p>

<ul>
<li>A <code>user</code> model exists with at least the following properties:</li>
</ul>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> <span class="pl-c1">Q</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>q<span class="pl-pds">'</span></span>);

<span class="pl-c1">module</span>.<span class="pl-en">exports</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">mongoose</span>) {
  <span class="pl-k">var</span> modelName <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>user<span class="pl-pds">"</span></span>;
  <span class="pl-k">var</span> Types <span class="pl-k">=</span> <span class="pl-smi">mongoose</span>.<span class="pl-smi">Schema</span>.<span class="pl-smi">Types</span>;
  <span class="pl-k">var</span> Schema <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">mongoose.Schema</span>({
    email<span class="pl-k">:</span> {
      type<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-smi">String</span>,
      required<span class="pl-k">:</span> <span class="pl-c1">true</span>,
      unique<span class="pl-k">:</span> <span class="pl-c1">true</span>
    },
    password<span class="pl-k">:</span> {
      type<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-smi">String</span>,
      required<span class="pl-k">:</span> <span class="pl-c1">true</span>,
      exclude<span class="pl-k">:</span> <span class="pl-c1">true</span>,
      allowOnUpdate<span class="pl-k">:</span> <span class="pl-c1">false</span>
    },
    token<span class="pl-k">:</span> {
      type<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-smi">String</span>,
      allowNull<span class="pl-k">:</span> <span class="pl-c1">true</span>,
      exclude<span class="pl-k">:</span> <span class="pl-c1">true</span>,
      allowOnUpdate<span class="pl-k">:</span> <span class="pl-c1">false</span>,
      allowOnCreate<span class="pl-k">:</span> <span class="pl-c1">false</span>
    },
    tokenCreatedAt<span class="pl-k">:</span> {
      type<span class="pl-k">:</span> <span class="pl-smi">Types</span>.<span class="pl-smi">String</span>,
      allowNull<span class="pl-k">:</span> <span class="pl-c1">true</span>,
      exclude<span class="pl-k">:</span> <span class="pl-c1">true</span>,
      allowOnUpdate<span class="pl-k">:</span> <span class="pl-c1">false</span>,
      allowOnCreate<span class="pl-k">:</span> <span class="pl-c1">false</span>
    }
  });

  <span class="pl-smi">Schema</span>.<span class="pl-smi">statics</span> <span class="pl-k">=</span> {
    collectionName<span class="pl-k">:</span>modelName,
    routeOptions<span class="pl-k">:</span> {
      create<span class="pl-k">:</span> {
        <span class="pl-en">pre</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">Log</span>) {
          <span class="pl-k">var</span> deferred <span class="pl-k">=</span> <span class="pl-c1">Q</span>.<span class="pl-c1">defer</span>();
          <span class="pl-k">var</span> passwordUtility <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>../../api/utilities/password-helper<span class="pl-pds">'</span></span>);
          <span class="pl-k">var</span> hashedPassword <span class="pl-k">=</span> <span class="pl-smi">passwordUtility</span>.<span class="pl-en">hash_password</span>(<span class="pl-smi">request</span>.<span class="pl-smi">payload</span>.<span class="pl-smi">password</span>);

          <span class="pl-smi">request</span>.<span class="pl-smi">payload</span>.<span class="pl-smi">password</span> <span class="pl-k">=</span> hashedPassword;
          <span class="pl-smi">deferred</span>.<span class="pl-en">resolve</span>(request);
          <span class="pl-k">return</span> <span class="pl-smi">deferred</span>.<span class="pl-smi">promise</span>;
        }
      }
    }
  };

  <span class="pl-k">return</span> Schema;
};</pre></div>

<p><strong>NOTE:</strong> Token authentication requires that passwords are encrypted using the password helper as above.</p>

<ul>
<li>The <code>auth</code> property in the config file is set to <code>"token"</code>.</li>
</ul>

<p>Given these conditions, a new endpoint will be generated:</p>

<pre><code>POST /token     Create a token for a user.
</code></pre>

<p>This endpoint takes a user email and password as a payload and returns an authentication token.  When token authentication is enabled, all generated enpoints require an Authentication header:</p>

<pre><code>Authorization: Bearer USER_TOKEN
</code></pre>

<p><a href="#readme-contents">Back to top</a></p>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>License</h2>

<p>MIT</p>

<p><a href="#readme-contents">Back to top</a></p>

<h2>
<a id="questions" class="anchor" href="#questions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Questions?</h2>

<p>If you have any questions/issues/feature requests, please feel free to open an issue.</p>

<p><a href="#readme-contents">Back to top</a></p>

<h2>
<a id="future-work" class="anchor" href="#future-work" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Future work</h2>

<p>This project is still in its infancy, and there are many features I would still like to add.  Below is a list of some possible future updates:</p>

<ul>
<li>support mongoose <code>$text</code> search query parameter</li>
<li>sorting through populate fields (Ex: sort users through role.name)</li>
<li>have built in <code>created_at</code> and <code>updated_at</code> fields for each model</li>
<li>support marking fields as <code>duplicate</code> i.e. any associated models referencing that model will duplicate those fields along with the reference Id. This could allow for a shallow embed that will return a list of reference ids with their "duplicate" values, and a full embed that will return the fully embedded references</li>
<li>support automatic logging of all operations via a <code>eventLogs</code> collection</li>
<li>support "soft" delete of mongo documents, i.e. documents are marked as "deleted" but remain in the db.</li>
<li>(LONG TERM) support mysql as well as mongodb</li>
</ul>

<p><a href="#readme-contents">Back to top</a></p>

<h2>
<a id="contributing" class="anchor" href="#contributing" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Contributing</h2>

<p>Please reference the contributing doc: <a href="https://github.com/JKHeadley/rest-hapi/blob/master/CONTRIBUTING.md">https://github.com/JKHeadley/rest-hapi/blob/master/CONTRIBUTING.md</a></p>

<p><a href="#readme-contents">Back to top</a></p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/JKHeadley/rest-hapi">rest-hapi</a> is maintained by <a href="https://github.com/JKHeadley">JKHeadley</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
